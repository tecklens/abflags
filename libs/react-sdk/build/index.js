"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("react/jsx-runtime"),l=require("react");function it(){return h.jsx("div",{children:h.jsx("h1",{children:"Welcome to ReactSdk!"})})}var z={exports:{}};function m(){}m.prototype={on:function(s,t,e){var i=this.e||(this.e={});return(i[s]||(i[s]=[])).push({fn:t,ctx:e}),this},once:function(s,t,e){var i=this;function r(){i.off(s,r),t.apply(e,arguments)}return r._=t,this.on(s,r,e)},emit:function(s){var t=[].slice.call(arguments,1),e=((this.e||(this.e={}))[s]||[]).slice(),i=0,r=e.length;for(i;i<r;i++)e[i].fn.apply(e[i].ctx,t);return this},off:function(s,t){var e=this.e||(this.e={}),i=e[s],r=[];if(i&&t)for(var n=0,a=i.length;n<a;n++)i[n].fn!==t&&i[n].fn._!==t&&r.push(i[n]);return r.length?e[s]=r:delete e[s],this}};z.exports=m;var rt=z.exports.TinyEmitter=m;const Q="api_key",p="session_id",g=30;let f;const nt=new Uint8Array(16);function ot(){if(!f&&(f=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!f))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(nt)}const o=[];for(let s=0;s<256;++s)o.push((s+256).toString(16).slice(1));function at(s,t=0){return o[s[t+0]]+o[s[t+1]]+o[s[t+2]]+o[s[t+3]]+"-"+o[s[t+4]]+o[s[t+5]]+"-"+o[s[t+6]]+o[s[t+7]]+"-"+o[s[t+8]]+o[s[t+9]]+"-"+o[s[t+10]]+o[s[t+11]]+o[s[t+12]]+o[s[t+13]]+o[s[t+14]]+o[s[t+15]]}const ct=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),v={randomUUID:ct};function ht(s,t,e){if(v.randomUUID&&!t&&!s)return v.randomUUID();s=s||{};const i=s.random||(s.rng||ot)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,at(i)}class lt{generateEventId(){return ht()}createImpressionEvent(t,e,i,r,n,a){const u=this.createBaseEvent(t,e,i,r,n);return a?{...u,variant:a}:u}createBaseEvent(t,e,i,r,n){return{eventType:r,eventId:this.generateEventId(),context:t,enabled:e,featureName:i,impressionData:n}}}class dt{constructor(t="ab:cache"){this.prefix=t}async save(t,e){const i=JSON.stringify(e),r=`${this.prefix}:${t}`;try{window.localStorage.setItem(r,i)}catch(n){console.error(n)}}get(t){try{const e=`${this.prefix}:${t}`,i=window.localStorage.getItem(e);return i?JSON.parse(i):void 0}catch(e){console.error(e)}}}class ut{constructor(){this.store=new Map}async save(t,e){this.store.set(t,e)}async get(t){return this.store.get(t)}}var b;const ft=((b=globalThis.window)==null?void 0:b.document)!==void 0;var w,I;const mt=((I=(w=globalThis.process)==null?void 0:w.versions)==null?void 0:I.node)!==void 0;var T,E;(E=(T=globalThis.process)==null?void 0:T.versions)==null||E.bun;var S,R;(R=(S=globalThis.Deno)==null?void 0:S.version)==null||R.deno;var _,A;(A=(_=globalThis.process)==null?void 0:_.versions)==null||A.electron;var x,k;(k=(x=globalThis.navigator)==null?void 0:x.userAgent)==null||k.includes("jsdom");typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;typeof DedicatedWorkerGlobalScope<"u"&&globalThis instanceof DedicatedWorkerGlobalScope;typeof SharedWorkerGlobalScope<"u"&&globalThis instanceof SharedWorkerGlobalScope;typeof ServiceWorkerGlobalScope<"u"&&globalThis instanceof ServiceWorkerGlobalScope;var N,U;const d=(U=(N=globalThis.navigator)==null?void 0:N.userAgentData)==null?void 0:U.platform;var D,P,C,O;const pt=d==="macOS"||((D=globalThis.navigator)==null?void 0:D.platform)==="MacIntel"||((C=(P=globalThis.navigator)==null?void 0:P.userAgent)==null?void 0:C.includes(" Mac "))===!0||((O=globalThis.process)==null?void 0:O.platform)==="darwin";var H,F;const gt=d==="Windows"||((H=globalThis.navigator)==null?void 0:H.platform)==="Win32"||((F=globalThis.process)==null?void 0:F.platform)==="win32";var M,j,K,L,W;const vt=d==="Linux"||((j=(M=globalThis.navigator)==null?void 0:M.platform)==null?void 0:j.startsWith("Linux"))===!0||((L=(K=globalThis.navigator)==null?void 0:K.userAgent)==null?void 0:L.includes(" Linux "))===!0||((W=globalThis.process)==null?void 0:W.platform)==="linux";var V,B,G;const yt=d==="iOS"||((V=globalThis.navigator)==null?void 0:V.platform)==="MacIntel"&&((B=globalThis.navigator)==null?void 0:B.maxTouchPoints)>1||/iPad|iPhone|iPod/.test((G=globalThis.navigator)==null?void 0:G.platform);var $,q,J,Y;d==="Android"||(($=globalThis.navigator)==null?void 0:$.platform)==="Android"||((J=(q=globalThis.navigator)==null?void 0:q.userAgent)==null?void 0:J.includes(" Android "))===!0||((Y=globalThis.process)==null||Y.platform);const c={INIT:"initialized",ERROR:"error",READY:"ready",UPDATE:"update",IMPRESSION:"impression",SENT:"sent",RECOVERED:"recovered"},X=([,s])=>s!=null,bt=s=>JSON.stringify(s),wt=async s=>{var r,n;const t=typeof globalThis<"u"&&((r=globalThis.crypto)!=null&&r.subtle)?(n=globalThis.crypto)==null?void 0:n.subtle:void 0;if(typeof TextEncoder>"u"||!(t!=null&&t.digest)||typeof Uint8Array>"u")throw new Error("Hashing function not available");const e=new TextEncoder().encode(s),i=await t.digest("SHA-256",e);return Array.from(new Uint8Array(i)).map(a=>a.toString(16).padStart(2,"0")).join("")},y=async s=>{const t=bt(s);try{return await wt(t)}catch{return t}},It=()=>{try{if(typeof window<"u"&&"fetch"in window)return fetch.bind(window);if("fetch"in globalThis)return fetch.bind(globalThis)}catch(s){console.error('Unleash failed to resolve "fetch"',s)}},Tt=()=>{try{if(typeof window<"u"&&"AbortController"in window)return new window.AbortController;if("fetch"in globalThis)return new globalThis.AbortController}catch(s){console.error('Unleash failed to resolve "AbortController" factory',s)}},Et=()=>({os:pt?"mac-os":gt?"window":vt?"linux":yt?"ios":"android",environment:ft?"browser":mt?"backend":"web-worker"}),St=()=>{};class Rt{constructor({onError:t,onSent:e,appName:i,metricsInterval:r,disableMetrics:n=!1,url:a,clientKey:u,fetch:tt,customHeaders:et={},metricsIntervalInitial:st}){this.onError=t,this.onSent=e||St,this.disabled=n,this.metricsInterval=r??1e3,this.metricsIntervalInitial=st??1e3,this.appName=i,this.url=a instanceof URL?a:new URL(a),this.clientKey=u,this.bucket=this.createEmptyBucket(),this.fetch=tt,this.customHeaders=et,this.environment=Et()}start(){if(this.disabled)return!1;typeof this.metricsInterval=="number"&&this.metricsInterval>0&&(this.metricsIntervalInitial&&this.metricsIntervalInitial>0?setTimeout(async()=>{this.startTimer(),await this.sendMetrics()},this.metricsIntervalInitial):this.startTimer())}stop(){this.timer&&(clearTimeout(this.timer),delete this.timer)}createEmptyBucket(){return{start:new Date,stop:null,features:{}}}getHeaders(){const t={[Q]:this.clientKey,Accept:"application/json","Content-Type":"application/json"};return Object.entries(this.customHeaders).filter(X).forEach(([e,i])=>t[e]=i),t}async sendMetrics(){const t=`${this.url}ab/v1/metric`,e=this.getPayload();if(!this.bucketIsEmpty(e))try{await this.fetch(t,{cache:"no-cache",method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)}),this.onSent(e)}catch(i){console.error("AbFlags: unable to send feature metrics",i),this.onError(i)}}count(t,e){return this.disabled||!this.bucket?!1:(this.assertBucket(t),this.bucket.features[t][e?"yes":"no"]++,!0)}assertBucket(t){if(this.disabled||!this.bucket)return!1;this.bucket.features[t]||(this.bucket.features[t]={yes:0,no:0})}startTimer(){this.timer=setInterval(async()=>{await this.sendMetrics()},this.metricsInterval)}bucketIsEmpty(t){return Object.keys(t.bucket.features).length===0}getPayload(){const t={...this.bucket,stop:new Date};return this.bucket=this.createEmptyBucket(),{bucket:t,createdAt:new Date,appName:this.appName,instanceId:"browser",os:this.environment.os,environment:this.environment.environment}}}class _t extends rt{constructor(t){if(super(),this.readyEventEmitted=!1,this.storeKey="feature",this.lastUpdateKey="last-time",this.etag="",this.fetchedFromServer=!1,this.started=!1,!t.clientKey)throw new Error("clientKey is required");if(!t.appName)throw new Error("appName is required.");this.eventsHandler=new lt,this.url=t.url??"https://ab.wolfx.app",this.storage=t.storageProvider||(typeof window<"u"?new dt:new ut),this.fetch=It(),this.fetch||console.error('You must either provide your own "fetch" implementation or run in an environment where "fetch" is available.'),this._config=t,this.ready=new Promise(e=>{this.init().then(e).catch(i=>{console.debug(i),this.state="error",this.emit(c.ERROR,i),this.lastError=i,e()})}),this.features=[],this.lastRefreshTimestamp=0,this.state="initializing",this.metrics=new Rt({onError:this.emit.bind(this,c.ERROR),onSent:this.emit.bind(this,c.SENT),appName:this._config.appName,metricsInterval:this._config.metricsInterval,disableMetrics:this._config.disableMetrics??!1,url:this.url,clientKey:this._config.clientKey,fetch:this.fetch,customHeaders:this._config.customHeaders,metricsIntervalInitial:this._config.metricsIntervalInitial??1e3})}async init(){this._config.sessionId=await this.resolveSessionId(),this.features=await this.storage.get(this.storeKey)||[],this.lastRefreshTimestamp=await this.getLastRefreshTimestamp(),this.state="healthy",this.emit(c.INIT)}async start(){if(this.started=!0,this.timerRef){console.error("SDK has already started, if you want to restart the SDK you should call client.stop() before starting again.");return}await this.ready,this.metrics.start();const t=this._config.refreshInterval&&this._config.refreshInterval>500?this._config.refreshInterval:g;await this.initialFetchFeatures(),t>0&&(this.timerRef=setInterval(()=>this.fetchFeatures(),t))}async getLastRefreshTimestamp(){const t=await this.storage.get(this.lastUpdateKey),e=await y({appName:this._config.appName,sessionId:this._config.sessionId,currentTime:this._config.currentTime,userId:this._config.userId,environment:this._config.environment,properties:this._config.properties});return(t==null?void 0:t.key)===e?t.timestamp:0}setReady(){this.readyEventEmitted=!0,this.emit(c.READY)}async storeLastRefreshTimestamp(){this.lastRefreshTimestamp=Date.now();const e={key:await y({appName:this._config.appName,sessionId:this._config.sessionId,currentTime:this._config.currentTime,userId:this._config.userId,environment:this._config.environment,properties:this._config.properties}),timestamp:this.lastRefreshTimestamp};await this.storage.save(this.lastUpdateKey,e)}async resolveSessionId(){let t=await this.storage.get(p);return t||(t=Math.floor(Math.random()*1e9),await this.storage.save(p,t.toString(10))),t.toString(10)}isUpToDate(){const t=Date.now(),e=this._config.refreshInterval&&this._config.refreshInterval>500?this._config.refreshInterval:g;return this.lastRefreshTimestamp>0&&this.lastRefreshTimestamp<=t&&t-this.lastRefreshTimestamp<=e}initialFetchFeatures(){if(this.isUpToDate()){this.fetchedFromServer||(this.fetchedFromServer=!0,this.setReady());return}return this.fetchFeatures()}async fetchFeatures(){if(this.fetch){this.abortController&&this.abortController.abort(),this.abortController=Tt();const t=this.abortController?this.abortController.signal:void 0;try{const e=new URL("/ab/v1/feature/frontend",this.url),i="GET";e.searchParams.set("appName",this._config.appName),e.searchParams.set("environment",this._config.environment??""),e.searchParams.set("userId",this._config.userId??""),e.searchParams.set("sessionId",this._config.sessionId??""),e.searchParams.set("currentTime",this._config.currentTime??new Date().toString());for(let n of Object.entries(this._config.properties??{}))e.searchParams.set(n[0],n[1]);const r=await this.fetch(e.toString(),{method:i,cache:"no-cache",headers:this.getHeaders(),signal:t});if(this.state==="error"&&r.status<400&&(this.state="healthy",this.emit(c.RECOVERED)),r.ok){this.etag=r.headers.get("ETag")||"";const n=await r.json();await this.storeFeatures(n),this.state!=="healthy"&&(this.state="healthy"),this.fetchedFromServer||(this.fetchedFromServer=!0,this.setReady()),this.storeLastRefreshTimestamp()}else r.status===304?this.storeLastRefreshTimestamp():(console.error("AbFlags: Fetching feature toggles did not have an ok response"),this.state="error",this.emit(c.ERROR,{type:"HttpError",code:r.status}),this.lastError={type:"HttpError",code:r.status})}catch(e){typeof e=="object"&&e!==null&&"name"in e&&e.name==="AbortError"||(console.error("AbFlags: unable to fetch feature toggles",e),this.state="error",this.emit(c.ERROR,e),this.lastError=e)}finally{this.abortController=null}}}async storeFeatures(t){this.features=t,this.emit(c.UPDATE),await this.storage.save(this.storeKey,t)}getHeaders(){const t={[Q]:this._config.clientKey,Accept:"application/json"};return t["Content-Type"]="application/json",this.etag&&(t["If-None-Match"]=this.etag),Object.entries(this._config.customHeaders??{}).filter(X).forEach(([e,i])=>t[e]=i),t}isEnabled(t){var i;const e=!!((i=this.features)!=null&&i.find(r=>r.name===t));return this.metrics.count(t,e),e}}const Z=l.createContext(void 0),At=({children:s,config:t})=>{const[e,i]=l.useState();l.useEffect(()=>{i(new _t({url:t.url,clientKey:t.clientKey,appName:t.appName,userId:t.userId,disableMetrics:t.disableMetrics,metricsInterval:t.metricsInterval,refreshInterval:t.refreshInterval}))},[t]);const r=l.useMemo(()=>({...t,client:e}),[t,e]);return h.jsx(h.Fragment,{children:h.jsx(Z.Provider,{value:r,children:s})})},xt=()=>l.useContext(Z);exports.AbClient=it;exports.AbProvider=At;exports.useAbflags=xt;
//# sourceMappingURL=index.js.map
