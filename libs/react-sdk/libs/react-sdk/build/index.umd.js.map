{"version":3,"file":"index.umd.js","sources":["../../../src/lib/ab-client.tsx","../../../../../node_modules/tiny-emitter/index.js","../../../../js-sdk/src/types/state.ts","../../../../../node_modules/uuid/dist/esm-browser/rng.js","../../../../../node_modules/uuid/dist/esm-browser/stringify.js","../../../../../node_modules/uuid/dist/esm-browser/native.js","../../../../../node_modules/uuid/dist/esm-browser/v4.js","../../../../js-sdk/src/lib/events-handler.ts","../../../../js-sdk/src/storage/storage-provider-local.ts","../../../../js-sdk/src/storage/storage-provider-inmemory.ts","../../../../js-sdk/node_modules/environment/index.js","../../../../js-sdk/src/utils/index.ts","../../../../js-sdk/src/lib/metrics.ts","../../../../js-sdk/src/lib/ab-client.ts","../../../src/lib/ab-provider.tsx"],"sourcesContent":["export function AbClient() {\n  return (\n    <div>\n      <h1>Welcome to ReactSdk!</h1>\n    </div>\n  );\n}\n\nexport default AbClient;\n","function E () {\n  // Keep this empty so it's easier to inherit from\n  // (via https://github.com/lipsmack from https://github.com/scottcorgan/tiny-emitter/issues/3)\n}\n\nE.prototype = {\n  on: function (name, callback, ctx) {\n    var e = this.e || (this.e = {});\n\n    (e[name] || (e[name] = [])).push({\n      fn: callback,\n      ctx: ctx\n    });\n\n    return this;\n  },\n\n  once: function (name, callback, ctx) {\n    var self = this;\n    function listener () {\n      self.off(name, listener);\n      callback.apply(ctx, arguments);\n    };\n\n    listener._ = callback\n    return this.on(name, listener, ctx);\n  },\n\n  emit: function (name) {\n    var data = [].slice.call(arguments, 1);\n    var evtArr = ((this.e || (this.e = {}))[name] || []).slice();\n    var i = 0;\n    var len = evtArr.length;\n\n    for (i; i < len; i++) {\n      evtArr[i].fn.apply(evtArr[i].ctx, data);\n    }\n\n    return this;\n  },\n\n  off: function (name, callback) {\n    var e = this.e || (this.e = {});\n    var evts = e[name];\n    var liveEvents = [];\n\n    if (evts && callback) {\n      for (var i = 0, len = evts.length; i < len; i++) {\n        if (evts[i].fn !== callback && evts[i].fn._ !== callback)\n          liveEvents.push(evts[i]);\n      }\n    }\n\n    // Remove event from queue to prevent memory leak\n    // Suggested by https://github.com/lazd\n    // Ref: https://github.com/scottcorgan/tiny-emitter/commit/c6ebfaa9bc973b33d110a84a307742b7cf94c953#commitcomment-5024910\n\n    (liveEvents.length)\n      ? e[name] = liveEvents\n      : delete e[name];\n\n    return this;\n  }\n};\n\nmodule.exports = E;\nmodule.exports.TinyEmitter = E;\n","export type SdkState = 'initializing' | 'error' | 'healthy';\r\n\r\nexport const HEADER_API_KEY = 'api_key'\r\nexport const HEADER_E_TAG = 'api_key'\r\nexport const SESSION_ID = 'session_id'\r\nexport const REFRESH_INTERVAL_INIT = 30\r\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]];\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","import { v4 as uuidv4 } from 'uuid';\r\nimport {AbContext} from \"../types\";\r\n\r\nclass EventsHandler {\r\n    private generateEventId() {\r\n        return uuidv4();\r\n    }\r\n\r\n    public createImpressionEvent(\r\n        context: AbContext,\r\n        enabled: boolean,\r\n        featureName: string,\r\n        eventType: string,\r\n        impressionData?: boolean,\r\n        variant?: string\r\n    ) {\r\n        const baseEvent = this.createBaseEvent(\r\n            context,\r\n            enabled,\r\n            featureName,\r\n            eventType,\r\n            impressionData\r\n        );\r\n\r\n        if (variant) {\r\n            return {\r\n                ...baseEvent,\r\n                variant,\r\n            };\r\n        }\r\n        return baseEvent;\r\n    }\r\n\r\n    private createBaseEvent(\r\n        context: AbContext,\r\n        enabled: boolean,\r\n        featureName: string,\r\n        eventType: string,\r\n        impressionData?: boolean\r\n    ) {\r\n        return {\r\n            eventType,\r\n            eventId: this.generateEventId(),\r\n            context,\r\n            enabled,\r\n            featureName,\r\n            impressionData,\r\n        };\r\n    }\r\n}\r\n\r\nexport default EventsHandler;\r\n","import {IStorageProvider} from \"./storage-provider\";\r\n\r\nexport class LocalStorageProvider implements IStorageProvider {\r\n  private readonly prefix: string;\r\n\r\n  constructor(name = 'ab:cache') {\r\n    this.prefix = name;\r\n  }\r\n\r\n  public async save(name: string, data: any) {\r\n    const repo = JSON.stringify(data);\r\n    const key = `${this.prefix}:${name}`;\r\n    try {\r\n      window.localStorage.setItem(key, repo);\r\n    } catch (ex) {\r\n      console.error(ex);\r\n    }\r\n  }\r\n\r\n  public get(name: string) {\r\n    try {\r\n      const key = `${this.prefix}:${name}`;\r\n      const data = window.localStorage.getItem(key);\r\n      return data ? JSON.parse(data) : undefined;\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n  }\r\n}\r\n","import {IStorageProvider} from './storage-provider';\r\n\r\nexport class InMemoryStorageProvider implements IStorageProvider {\r\n  private store = new Map();\r\n\r\n  public async save(name: string, data: any) {\r\n    this.store.set(name, data);\r\n  }\r\n\r\n  public async get(name: string) {\r\n    return this.store.get(name);\r\n  }\r\n}\r\n","/* globals WorkerGlobalScope, DedicatedWorkerGlobalScope, SharedWorkerGlobalScope, ServiceWorkerGlobalScope */\n\nexport const isBrowser = globalThis.window?.document !== undefined;\n\nexport const isNode = globalThis.process?.versions?.node !== undefined;\n\nexport const isBun = globalThis.process?.versions?.bun !== undefined;\n\nexport const isDeno = globalThis.Deno?.version?.deno !== undefined;\n\nexport const isElectron = globalThis.process?.versions?.electron !== undefined;\n\nexport const isJsDom = globalThis.navigator?.userAgent?.includes('jsdom') === true;\n\nexport const isWebWorker = typeof WorkerGlobalScope !== 'undefined' && globalThis instanceof WorkerGlobalScope;\n\nexport const isDedicatedWorker = typeof DedicatedWorkerGlobalScope !== 'undefined' && globalThis instanceof DedicatedWorkerGlobalScope;\n\nexport const isSharedWorker = typeof SharedWorkerGlobalScope !== 'undefined' && globalThis instanceof SharedWorkerGlobalScope;\n\nexport const isServiceWorker = typeof ServiceWorkerGlobalScope !== 'undefined' && globalThis instanceof ServiceWorkerGlobalScope;\n\n// Note: I'm intentionally not DRYing up the other variables to keep them \"lazy\".\nconst platform = globalThis.navigator?.userAgentData?.platform;\n\nexport const isMacOs = platform === 'macOS'\n\t|| globalThis.navigator?.platform === 'MacIntel' // Even on Apple silicon Macs.\n\t|| globalThis.navigator?.userAgent?.includes(' Mac ') === true\n\t|| globalThis.process?.platform === 'darwin';\n\nexport const isWindows = platform === 'Windows'\n\t|| globalThis.navigator?.platform === 'Win32'\n\t|| globalThis.process?.platform === 'win32';\n\nexport const isLinux = platform === 'Linux'\n\t|| globalThis.navigator?.platform?.startsWith('Linux') === true\n\t|| globalThis.navigator?.userAgent?.includes(' Linux ') === true\n\t|| globalThis.process?.platform === 'linux';\n\nexport const isIos = platform === 'iOS'\n\t|| (globalThis.navigator?.platform === 'MacIntel' && globalThis.navigator?.maxTouchPoints > 1)\n\t|| /iPad|iPhone|iPod/.test(globalThis.navigator?.platform);\n\nexport const isAndroid = platform === 'Android'\n\t|| globalThis.navigator?.platform === 'Android'\n\t|| globalThis.navigator?.userAgent?.includes(' Android ') === true\n\t|| globalThis.process?.platform === 'android';\n","import {AbContext, Environment} from \"../types\";\r\nimport {isBrowser, isIos, isLinux, isMacOs, isNode, isWindows} from 'environment';\r\n\r\nexport const EVENTS = {\r\n  INIT: 'initialized',\r\n  ERROR: 'error',\r\n  READY: 'ready',\r\n  UPDATE: 'update',\r\n  IMPRESSION: 'impression',\r\n  SENT: 'sent',\r\n  RECOVERED: 'recovered',\r\n};\r\n\r\nexport const notNullOrUndefined = ([, value]: [string, string]) =>\r\n  value !== undefined && value !== null;\r\n\r\nexport const contextString = (context: AbContext): string => {\r\n\r\n  return JSON.stringify(context);\r\n};\r\n\r\nconst sha256 = async (input: string): Promise<string> => {\r\n  const cryptoSubtle =\r\n    typeof globalThis !== 'undefined' && globalThis.crypto?.subtle\r\n      ? globalThis.crypto?.subtle\r\n      : undefined;\r\n\r\n  if (\r\n    typeof TextEncoder === 'undefined' ||\r\n    !cryptoSubtle?.digest ||\r\n    typeof Uint8Array === 'undefined'\r\n  ) {\r\n    throw new Error('Hashing function not available');\r\n  }\r\n\r\n  const msgUint8 = new TextEncoder().encode(input);\r\n  const hashBuffer = await cryptoSubtle.digest('SHA-256', msgUint8);\r\n  return Array.from(new Uint8Array(hashBuffer))\r\n    .map((x) => x.toString(16).padStart(2, '0'))\r\n    .join('');\r\n};\r\nexport const computeContextHashValue = async (obj: AbContext) => {\r\n  const value = contextString(obj);\r\n\r\n  try {\r\n    return await sha256(value);\r\n  } catch {\r\n    return value;\r\n  }\r\n};\r\n\r\nexport const resolveFetch = () => {\r\n  try {\r\n    if (typeof window !== 'undefined' && 'fetch' in window) {\r\n      return fetch.bind(window);\r\n    }\r\n\r\n    if ('fetch' in globalThis) {\r\n      return fetch.bind(globalThis);\r\n    }\r\n  } catch (e) {\r\n    console.error('Unleash failed to resolve \"fetch\"', e);\r\n  }\r\n\r\n  return undefined;\r\n};\r\n\r\nexport const resolveAbortController = () => {\r\n  try {\r\n    if (typeof window !== 'undefined' && 'AbortController' in window) {\r\n      return new window.AbortController();\r\n    }\r\n\r\n    if ('fetch' in globalThis) {\r\n      return new globalThis.AbortController();\r\n    }\r\n  } catch (e) {\r\n    console.error('Unleash failed to resolve \"AbortController\" factory', e);\r\n  }\r\n};\r\n\r\nexport const currentEnvironment: () => Environment = () => {\r\n  return {\r\n    os: isMacOs ? 'mac-os'\r\n      : isWindows ? 'window'\r\n        : isLinux ? 'linux'\r\n          : isIos ? 'ios'\r\n            : 'android',\r\n    environment: isBrowser\r\n      ? 'browser'\r\n      : isNode\r\n        ? 'backend'\r\n        : 'web-worker'\r\n  }\r\n}\r\n","import {currentEnvironment, notNullOrUndefined} from \"../utils\";\r\nimport {Environment, HEADER_API_KEY} from \"../types\";\r\n\r\nexport interface MetricsOptions {\r\n  onError: OnError;\r\n  onSent?: OnSent;\r\n  appName: string;\r\n  metricsInterval?: number;\r\n  disableMetrics?: boolean;\r\n  url: URL | string;\r\n  clientKey: string;\r\n  fetch: any;\r\n  customHeaders?: Record<string, string>;\r\n  metricsIntervalInitial?: number;\r\n}\r\n\r\ninterface Bucket {\r\n  start: Date;\r\n  stop: Date | null;\r\n  features: {\r\n    [s: string]: { yes: number; no: number; };\r\n  };\r\n}\r\n\r\ninterface Payload {\r\n  bucket: Bucket;\r\n  appName: string;\r\n  instanceId: string;\r\n  createdAt: Date;\r\n  os: string;\r\n  environment: string;\r\n}\r\n\r\ntype OnError = (error: unknown) => void;\r\ntype OnSent = (payload: Payload) => void;\r\n// eslint-disable-next-line @typescript-eslint/no-empty-function\r\nconst doNothing = () => {};\r\n\r\nexport class Metrics {\r\n  private readonly onError: OnError;\r\n  private readonly onSent: OnSent;\r\n  private bucket: Bucket;\r\n  private readonly appName: string;\r\n  private readonly metricsInterval?: number;\r\n  private readonly disabled: boolean;\r\n  private readonly url: URL;\r\n  private readonly clientKey: string;\r\n  private timer: any;\r\n  private readonly fetch: any;\r\n  private customHeaders: Record<string, string>;\r\n  private readonly metricsIntervalInitial?: number;\r\n  private environment: Environment;\r\n\r\n  constructor({\r\n                onError,\r\n                onSent,\r\n                appName,\r\n                metricsInterval,\r\n                disableMetrics = false,\r\n                url,\r\n                clientKey,\r\n                fetch,\r\n                customHeaders = {},\r\n                metricsIntervalInitial,\r\n              }: MetricsOptions) {\r\n    this.onError = onError;\r\n    this.onSent = onSent || doNothing;\r\n    this.disabled = disableMetrics;\r\n    this.metricsInterval = metricsInterval ??  1000;\r\n    this.metricsIntervalInitial = metricsIntervalInitial ?? 1000;\r\n    this.appName = appName;\r\n    this.url = url instanceof URL ? url : new URL(url);\r\n    this.clientKey = clientKey;\r\n    this.bucket = this.createEmptyBucket();\r\n    this.fetch = fetch;\r\n    this.customHeaders = customHeaders;\r\n    this.environment = currentEnvironment();\r\n  }\r\n\r\n  public start() {\r\n    if (this.disabled) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      typeof this.metricsInterval === 'number' &&\r\n      this.metricsInterval > 0\r\n    ) {\r\n      if (this.metricsIntervalInitial && this.metricsIntervalInitial > 0) {\r\n        setTimeout(async () => {\r\n          this.startTimer();\r\n          await this.sendMetrics();\r\n        }, this.metricsIntervalInitial);\r\n      } else {\r\n        this.startTimer();\r\n      }\r\n    }\r\n  }\r\n\r\n  public stop() {\r\n    if (this.timer) {\r\n      clearTimeout(this.timer);\r\n      delete this.timer;\r\n    }\r\n  }\r\n\r\n  public createEmptyBucket(): Bucket {\r\n    return {\r\n      start: new Date(),\r\n      stop: null,\r\n      features: {},\r\n    };\r\n  }\r\n\r\n  private getHeaders() {\r\n    const headers: Record<string, string> = {\r\n      [HEADER_API_KEY]: this.clientKey,\r\n      'Accept': 'application/json',\r\n      'Content-Type': 'application/json',\r\n    };\r\n\r\n    Object.entries(this.customHeaders)\r\n      .filter(notNullOrUndefined)\r\n      .forEach(([name, value]) => (headers[name] = value));\r\n\r\n    return headers;\r\n  }\r\n\r\n  public async sendMetrics(): Promise<void> {\r\n    /* istanbul ignore next if */\r\n\r\n    const url = `${this.url}ab/v1/metric`;\r\n    const payload = this.getPayload();\r\n\r\n    if (this.bucketIsEmpty(payload)) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await this.fetch(url, {\r\n        cache: 'no-cache',\r\n        method: 'POST',\r\n        headers: this.getHeaders(),\r\n        body: JSON.stringify(payload),\r\n      });\r\n      this.onSent(payload);\r\n    } catch (e) {\r\n      console.error('AbFlags: unable to send feature metrics', e);\r\n      this.onError(e);\r\n    }\r\n  }\r\n\r\n  public count(name: string, enabled: boolean): boolean {\r\n    if (this.disabled || !this.bucket) {\r\n      return false;\r\n    }\r\n    this.assertBucket(name);\r\n    this.bucket.features[name][enabled ? 'yes' : 'no']++;\r\n    return true;\r\n  }\r\n\r\n  private assertBucket(name: string) {\r\n    if (this.disabled || !this.bucket) {\r\n      return false;\r\n    }\r\n    if (!this.bucket.features[name]) {\r\n      this.bucket.features[name] = {\r\n        yes: 0,\r\n        no: 0,\r\n      };\r\n    }\r\n  }\r\n\r\n  private startTimer(): void {\r\n    this.timer = setInterval(async () => {\r\n      await this.sendMetrics();\r\n    }, this.metricsInterval);\r\n  }\r\n\r\n  private bucketIsEmpty(payload: Payload) {\r\n    return Object.keys(payload.bucket.features).length === 0;\r\n  }\r\n\r\n  private getPayload(): Payload {\r\n    const bucket = { ...this.bucket, stop: new Date() };\r\n    this.bucket = this.createEmptyBucket();\r\n\r\n    return {\r\n      bucket,\r\n      createdAt: new Date(),\r\n      appName: this.appName,\r\n      instanceId: 'browser',\r\n      os: this.environment.os,\r\n      environment: this.environment.environment,\r\n    };\r\n  }\r\n}\r\n","import {TinyEmitter} from \"tiny-emitter\";\r\nimport {Feature, HEADER_API_KEY, IConfig, LastUpdateTerms, REFRESH_INTERVAL_INIT, SdkState, SESSION_ID} from \"../types\";\r\nimport EventsHandler from \"./events-handler\";\r\nimport {InMemoryStorageProvider, IStorageProvider, LocalStorageProvider} from \"../storage\";\r\nimport {computeContextHashValue, EVENTS, notNullOrUndefined, resolveAbortController, resolveFetch} from \"../utils\";\r\nimport {Metrics} from \"./metrics\";\r\n\r\nexport class AbClient extends TinyEmitter {\r\n  private _config: IConfig;\r\n  private eventsHandler: EventsHandler;\r\n  private readonly url: string;\r\n  private storage: IStorageProvider;\r\n  private state: SdkState;\r\n  private metrics: Metrics;\r\n  private readyEventEmitted = false;\r\n  private readonly storeKey = 'feature';\r\n  private readonly lastUpdateKey = 'last-time';\r\n  private lastRefreshTimestamp: number;\r\n  private features?: Feature[];\r\n  private readonly fetch: any;\r\n  private etag: string = '';\r\n  private abortController?: AbortController | null;\r\n  private lastError: any;\r\n  private fetchedFromServer = false;\r\n  private readonly ready: Promise<void>;\r\n  private started = false;\r\n  private timerRef?: any;\r\n\r\n  constructor(config: IConfig) {\r\n    super();\r\n\r\n    if (!config.clientKey) {\r\n      throw new Error('clientKey is required');\r\n    }\r\n    if (!config.appName) {\r\n      throw new Error('appName is required.');\r\n    }\r\n\r\n    this.eventsHandler = new EventsHandler();\r\n\r\n    this.url = config.url ?? 'https://ab.wolfx.app';\r\n\r\n    // * init storage\r\n    this.storage =\r\n      config.storageProvider ||\r\n      (typeof window !== 'undefined'\r\n        ? new LocalStorageProvider()\r\n        : new InMemoryStorageProvider());\r\n    this.fetch = resolveFetch()\r\n    if (!this.fetch) {\r\n      console.error(\r\n        'You must either provide your own \"fetch\" implementation or run in an environment where \"fetch\" is available.'\r\n      );\r\n    }\r\n\r\n    this._config = config;\r\n    this.ready = new Promise((resolve) => {\r\n      this.init()\r\n        .then(resolve)\r\n        .catch((error) => {\r\n          console.debug(error);\r\n          this.state = 'error';\r\n          this.emit(EVENTS.ERROR, error);\r\n          this.lastError = error;\r\n          resolve();\r\n        });\r\n    });\r\n    this.features = [];\r\n    this.lastRefreshTimestamp = 0;\r\n    this.state = 'initializing';\r\n\r\n    this.metrics = new Metrics({\r\n      onError: this.emit.bind(this, EVENTS.ERROR),\r\n      onSent: this.emit.bind(this, EVENTS.SENT),\r\n      appName: this._config.appName,\r\n      metricsInterval: this._config.metricsInterval,\r\n      disableMetrics: this._config.disableMetrics ?? false,\r\n      url: this.url,\r\n      clientKey: this._config.clientKey,\r\n      fetch: this.fetch,\r\n      customHeaders: this._config.customHeaders,\r\n      metricsIntervalInitial: this._config.metricsIntervalInitial ?? 1000,\r\n    });\r\n  }\r\n\r\n  private async init(): Promise<void> {\r\n    this._config.sessionId = await this.resolveSessionId();\r\n\r\n    this.features = (await this.storage.get(this.storeKey)) || [];\r\n    this.lastRefreshTimestamp = await this.getLastRefreshTimestamp();\r\n\r\n    this.state = 'healthy';\r\n    this.emit(EVENTS.INIT);\r\n  }\r\n\r\n  public async start(): Promise<void> {\r\n    this.started = true;\r\n    if (this.timerRef) {\r\n      console.error(\r\n        'SDK has already started, if you want to restart the SDK you should call client.stop() before starting again.'\r\n      );\r\n      return;\r\n    }\r\n    await this.ready;\r\n    this.metrics.start();\r\n    const interval = this._config.refreshInterval && this._config.refreshInterval > 500 ? this._config.refreshInterval : REFRESH_INTERVAL_INIT;\r\n\r\n    await this.initialFetchFeatures();\r\n\r\n    if (interval > 0) {\r\n      this.timerRef = setInterval(() => this.fetchFeatures(), interval);\r\n    }\r\n  }\r\n\r\n  private async getLastRefreshTimestamp(): Promise<number> {\r\n    const lastRefresh: LastUpdateTerms | undefined =\r\n      await this.storage.get(this.lastUpdateKey);\r\n    const contextHash = await computeContextHashValue({\r\n      appName: this._config.appName,\r\n      sessionId: this._config.sessionId,\r\n      currentTime: this._config.currentTime,\r\n      userId: this._config.userId,\r\n      environment: this._config.environment,\r\n      properties: this._config.properties,\r\n    });\r\n    return lastRefresh?.key === contextHash ? lastRefresh.timestamp : 0;\r\n  }\r\n\r\n  private setReady() {\r\n    this.readyEventEmitted = true;\r\n    this.emit(EVENTS.READY);\r\n  }\r\n\r\n  private async storeLastRefreshTimestamp(): Promise<void> {\r\n    this.lastRefreshTimestamp = Date.now();\r\n\r\n    const contextHash = await computeContextHashValue({\r\n      appName: this._config.appName,\r\n      sessionId: this._config.sessionId,\r\n      currentTime: this._config.currentTime,\r\n      userId: this._config.userId,\r\n      environment: this._config.environment,\r\n      properties: this._config.properties,\r\n    });\r\n    const lastUpdateValue: LastUpdateTerms = {\r\n      key: contextHash,\r\n      timestamp: this.lastRefreshTimestamp,\r\n    };\r\n    await this.storage.save(this.lastUpdateKey, lastUpdateValue);\r\n  }\r\n\r\n  private async resolveSessionId(): Promise<string> {\r\n    let sessionId = await this.storage.get(SESSION_ID);\r\n    if (!sessionId) {\r\n      sessionId = Math.floor(Math.random() * 1_000_000_000);\r\n      await this.storage.save(SESSION_ID, sessionId.toString(10));\r\n    }\r\n    return sessionId.toString(10);\r\n  }\r\n\r\n  private isUpToDate(): boolean {\r\n    const now = Date.now();\r\n\r\n    const ttl = this._config.refreshInterval && this._config.refreshInterval > 500 ? this._config.refreshInterval : REFRESH_INTERVAL_INIT;\r\n\r\n    return (\r\n      this.lastRefreshTimestamp > 0 &&\r\n      this.lastRefreshTimestamp <= now &&\r\n      now - this.lastRefreshTimestamp <= ttl\r\n    );\r\n  }\r\n\r\n  private initialFetchFeatures() {\r\n    if (this.isUpToDate()) {\r\n      if (!this.fetchedFromServer) {\r\n        this.fetchedFromServer = true;\r\n        this.setReady();\r\n      }\r\n      return;\r\n    }\r\n    return this.fetchFeatures();\r\n  }\r\n\r\n  private async fetchFeatures() {\r\n    if (this.fetch) {\r\n      if (this.abortController) {\r\n        this.abortController.abort();\r\n      }\r\n      this.abortController = resolveAbortController();\r\n      const signal = this.abortController\r\n        ? this.abortController.signal\r\n        : undefined;\r\n      try {\r\n        const url = new URL('/ab/v1/feature/frontend', this.url);\r\n        const method = 'GET';\r\n        url.searchParams.set('appName', this._config.appName)\r\n        url.searchParams.set('environment', this._config.environment ?? '')\r\n        url.searchParams.set('userId', this._config.userId ?? '')\r\n        url.searchParams.set('sessionId', this._config.sessionId ?? '')\r\n        url.searchParams.set('currentTime', this._config.currentTime ?? new Date().toString())\r\n        for (let entry of Object.entries(this._config.properties ?? {})) {\r\n          url.searchParams.set(entry[0], entry[1])\r\n        }\r\n\r\n        const response = await this.fetch(url.toString(), {\r\n          method,\r\n          cache: 'no-cache',\r\n          headers: this.getHeaders(),\r\n          signal,\r\n        });\r\n        if (this.state === 'error' && response.status < 400) {\r\n          this.state = 'healthy';\r\n          this.emit(EVENTS.RECOVERED);\r\n        }\r\n\r\n        if (response.ok) {\r\n          this.etag = response.headers.get('ETag') || '';\r\n          const data = await response.json();\r\n\r\n          await this.storeFeatures(data);\r\n\r\n          if (this.state !== 'healthy') {\r\n            this.state = 'healthy';\r\n          }\r\n          if (!this.fetchedFromServer) {\r\n            this.fetchedFromServer = true;\r\n            this.setReady();\r\n          }\r\n          this.storeLastRefreshTimestamp();\r\n        } else if (response.status === 304) {\r\n          this.storeLastRefreshTimestamp();\r\n        } else {\r\n          console.error(\r\n            'AbFlags: Fetching feature toggles did not have an ok response'\r\n          );\r\n          this.state = 'error';\r\n          this.emit(EVENTS.ERROR, {\r\n            type: 'HttpError',\r\n            code: response.status,\r\n          });\r\n\r\n          this.lastError = {\r\n            type: 'HttpError',\r\n            code: response.status,\r\n          };\r\n        }\r\n      } catch (e) {\r\n        if (\r\n          !(\r\n            typeof e === 'object' &&\r\n            e !== null &&\r\n            'name' in e &&\r\n            e.name === 'AbortError'\r\n          )\r\n        ) {\r\n          console.error(\r\n            'AbFlags: unable to fetch feature toggles',\r\n            e\r\n          );\r\n          this.state = 'error';\r\n          this.emit(EVENTS.ERROR, e);\r\n          this.lastError = e;\r\n        }\r\n      } finally {\r\n        this.abortController = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  private async storeFeatures(features: Feature[]): Promise<void> {\r\n    this.features = features;\r\n    this.emit(EVENTS.UPDATE);\r\n    await this.storage.save(this.storeKey, features);\r\n  }\r\n\r\n  private getHeaders() {\r\n    const headers: Record<string, string> = {\r\n      [HEADER_API_KEY]: this._config.clientKey,\r\n      Accept: 'application/json',\r\n    };\r\n    headers['Content-Type'] = 'application/json';\r\n    if (this.etag) {\r\n      headers['If-None-Match'] = this.etag;\r\n    }\r\n    Object.entries(this._config.customHeaders ?? {})\r\n      .filter(notNullOrUndefined)\r\n      .forEach(([name, value]) => (headers[name] = value));\r\n    return headers;\r\n  }\r\n\r\n  isEnabled(key: string) {\r\n    const enabled = !!this.features?.find(f => f.name === key)\r\n\r\n    this.metrics.count(key, enabled);\r\n\r\n    return enabled;\r\n  }\r\n}\r\n","import React, {createContext, useContext, useEffect, useMemo} from \"react\";\nimport {AbClient} from \"@abflags/js-sdk\";\n\ninterface IAbContext {\n  url: string,\n  clientKey: string,\n  appName: string,\n  userId: string,\n  refreshInterval?: number,\n  metricsInterval?: number,\n  disableMetrics: false,\n}\n\nconst AbContext = createContext<IAbContext | undefined>(undefined);\n\nexport const AbProvider = ({children, config}: { config: IAbContext, children: React.ReactNode }) => {\n  const [client, setClient] = React.useState<AbClient>()\n\n  useEffect(() => {\n    setClient(new AbClient({\n      url: config.url,\n      clientKey: config.clientKey,\n      appName: config.appName,\n      userId: config.userId,\n      disableMetrics: config.disableMetrics,\n      metricsInterval: config.metricsInterval,\n      refreshInterval: config.refreshInterval,\n    }))\n  }, [config])\n\n  const contextValue = useMemo(\n    () => ({\n      ...config,\n      client,\n    }),\n    [config, client]\n  );\n\n  return (\n    <>\n      <AbContext.Provider value={contextValue}>{children}</AbContext.Provider>\n    </>\n  );\n};\n\nexport const useAbflags: () => any = () => {\n  return useContext(AbContext);\n};\n"],"names":["AbClient","jsx","E","name","callback","ctx","e","self","listener","data","evtArr","len","evts","liveEvents","i","tinyEmitter","TinyEmitter","tinyEmitterModule","HEADER_API_KEY","SESSION_ID","REFRESH_INTERVAL_INIT","getRandomValues","rnds8","rng","byteToHex","unsafeStringify","arr","offset","native","v4","options","buf","rnds","EventsHandler","uuidv4","context","enabled","featureName","eventType","impressionData","variant","baseEvent","LocalStorageProvider","repo","key","ex","InMemoryStorageProvider","isBrowser","_a","isNode","_c","_b","_e","_d","_g","_f","_i","_h","_k","_j","platform","_m","_l","isMacOs","_n","_p","_o","_q","isWindows","_r","_s","isLinux","_u","_t","_w","_v","_x","isIos","_y","_z","_A","_B","_D","_C","_E","EVENTS","notNullOrUndefined","value","contextString","sha256","input","cryptoSubtle","msgUint8","hashBuffer","x","computeContextHashValue","obj","resolveFetch","resolveAbortController","currentEnvironment","doNothing","Metrics","onError","onSent","appName","metricsInterval","disableMetrics","url","clientKey","fetch","customHeaders","metricsIntervalInitial","headers","payload","bucket","config","resolve","error","interval","lastRefresh","contextHash","lastUpdateValue","sessionId","now","ttl","signal","method","entry","response","features","f","AbContext","createContext","AbProvider","children","client","setClient","React","useEffect","contextValue","useMemo","Fragment","useAbflags","useContext"],"mappings":"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","x_google_ignoreList":[1,3,4,5,6,10]}